import unittest
from tx import Transaction
import json


class TestTransation(unittest.TestCase):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.maxDiff = None

    def test_witness_tx(self):
        tx_hex = "020000000001014e3cd415635d53518d162dd9cedd2173da7234760b1f7aa7f6bb3946b63d283e0100000000fdffffff0234700000000000001600146e470afa1366f07125b1638e99586327e3c17af99a09360000000000160014c6af146c1b3cfe443c09cd7c06fb12a59ad9051002483045022100cba3efd18e7190b2927a94d51108a132c258d949b1ac0e55c7b6a87dee93e82e02200984996b234a39de2bd7e1f5b3f76d31688c38bf0304a95fc717d88a51a04498012102c482d6683ed1ca34571770bb71aafe633b970bc077c14b64d1822a6effb4878900000000"
        tx = Transaction(tx_hex)
        tx_hex_2 = tx.to_hex()
        self.assertEqual(tx_hex, tx_hex_2)

    def test_legacy_tx(self):
        tx_hex = "0100000001ca6f756063374f4becc0c1a9cdadd7ba5280628e85cfe913b74e430acac2832b010000006b483045022100cfb9859fac5da682f6cebfa91edce02b14cb02055f96a3923a4e49391d19c426022063d5cf657c6dae418fd5148b50a5d3c47dac08621d4a1f80824c0ab9a2ec679301210263edb55eb14e554f816f1eb15d239f52d9089200034eecf7e8a6851b575bfb7dffffffff02905f0100000000001976a914307893c7b1618d0c89594c80b3c1bf1bef9e6a9c88aca58b4102000000001976a9140f2b734427c169a1b312105e1185517d57e1fbe188ac00000000"
        tx = Transaction(tx_hex)
        tx_hex_2 = tx.to_hex()
        self.assertEqual(tx_hex, tx_hex_2)

    def test_legacy_from_json(self):
        file_path = "tx-json/legacy.json"
        tx_hex = "01000000030dd7891efbf67da47c651531db8aab3144ed7a524e4ae1e30b773525e27ddd7b000000004948304502206f6a68710a51f77e5a1fa4d1037a23a76723724a51fd54710949e0189ee02dfa022100dad3454ade12fe84f3818e14c41ec2e02bbb154dd3136a094cdf86f67ebbe0b601ffffffff16851666962e37a75a246101f2e340c628b1db3c045d4d3cfb2d1c0f58f97c6f000000008b48304502203f004eeed0cef2715643e2f25a27a28f3c578e94c7f0f6a4df104e7d163f7f8f022100b8b248c1cfd8f77a0365107a9511d759b7544d979dd152a955c867afac0ef7860141044d05240cfbd8a2786eda9dadd520c1609b8593ff8641018d57703d02ba687cf2f187f0cee2221c3afb1b5ff7888caced2423916b61444666ca1216f26181398cffffffffffda5d38e91fd9a0d92872d51f83cb746fc7bf5d3ff13402f8d0d5ed60ddc79c0000000049483045022100b6fd43f2fa16e092678283f64d2e08fb2070b4af2b3ddfb9ca3c5e238288acaa02200c5a28e0a4fc1a540f6eeb30ccc4788050eae46964fe33ccb4500c3de1320c2501ffffffff02c0c62d00000000001976a91417194e1bd175fb5b1b2a1f9d221f6f5c29e1928388ac00c817a8040000001976a91465bda9b05f7e9a8f96a7f4ba0996a877708ef90888ac00000000"
        with open(file_path, 'r') as file:
            tx_json = json.load(file)
        tx = Transaction(tx_json)
        tx_hex_2 = tx.to_hex()
        self.assertEqual(tx_hex, tx_hex_2)

    def test_segwit_from_json(self):
        file_path = "tx-json/segwit.json"
        tx_hex = "02000000000106be778a8d6493de9cae18155c3c761b9334d6223916310348c17c587f2fb7992c0500000000ffffffffb529dd3f119f36705bee141134aca6d1400fbf6ab22927ca1b16a6846ab351df0000000000ffffffffb0e5e81a0e4fa61bac8fa31f11eb0a4a58d97b6ca9b2445f36bfd26662c350000000000000ffffffffabd075d382452621f65a24d921ff4dcc813a300a9517ffb3e7a514197becb6da0000000000ffffffff4a01d9e9564bb99949ff91cc4554832f1c0c1bb37acaa02bc83f011f4a505da20000000000ffffffffcd39ad5bcb73b1c0c611dda48499c8963cb80725a2cb801d39b202558e13c3b80200000000ffffffff05e4381101000000001600148a8c751ab2a5fe26e68210b36019c6b0bfe0246900ee020000000000225120943e0e9878cf21609289994525741ddae45e83d73ffe73283c311cc65d11200fa0fd020000000000225120943e0e9878cf21609289994525741ddae45e83d73ffe73283c311cc65d11200fa062070000000000225120270da8a60c0d7f197e45cf49d3c0367c74739a9c49434ad6b491aaf88c7c57e384310900000000002251205674a20e0690c723138a032d5852fbee91f702ed83efd71f65b9b02224d34e680140c2907f4fd021b2ce513c7913d2d89692a4880a28a359f764935ff6474687547874cc2021cbc7ee97fe35040338c62311349c7fe6debdf12ea79c2122dfc7901001416027f838bc31e24523c83c9e9df04df6ba970348ae7bd5c0346062c562910a74ae4807a41dd41ac5bd83c69ce35165a6e7119d14e9c605b918ac766929599dd3830141cfee2552147af1f4112068197886359a25868cad9b17d2af7ae47784180a03f61b89bf54db4177e4db52755b2c2594314fd46850eca080c09813d12bfc699955830141ec28538e01eca31282dca1df1b018ba430a27bc8f0cd409ff4985f74bcde81e8e663bf3fe73b884bd69a54eb4c0e154552f9882b7d0f4db6db8b1d28d2edf1398301410029733548627ca3bc366575203481e94cc01ae9c03a535b40ce50d1a72472e077e6210cb227a6bc3efa4cf4bd63c94f4fdf9f523fac40eccc17e525600284b8830140ed4ba22ed2ba0eb1a21c941e261107c70942860ceccc9d69df816706e126eb7908c168c5c67f9d28993363656ecf836f889e34ada97ae6754e7dfee58d22f67000000000"
        with open(file_path, 'r') as file:
            tx_json = json.load(file)
        tx = Transaction(tx_json)
        tx_hex_2 = tx.to_hex()
        self.assertEqual(tx_hex, tx_hex_2)

    def test_noir_legacy_template(self):
        tx_hex = "01000000030dd7891efbf67da47c651531db8aab3144ed7a524e4ae1e30b773525e27ddd7b0000000000ffffffff16851666962e37a75a246101f2e340c628b1db3c045d4d3cfb2d1c0f58f97c6f0000000000ffffffffffda5d38e91fd9a0d92872d51f83cb746fc7bf5d3ff13402f8d0d5ed60ddc79c0000000000ffffffff02c0c62d00000000001976a91417194e1bd175fb5b1b2a1f9d221f6f5c29e1928388ac00c817a8040000001976a91465bda9b05f7e9a8f96a7f4ba0996a877708ef90888ac00000000"
        template = "Transaction::<201, 3, 1, 124, 2, 1, 69, 0, 0>"
        tx = Transaction(tx_hex)
        self.assertEqual(tx.print_noir_template(), template)


if __name__ == "__main__":
    unittest.main()
